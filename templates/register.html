{% extends "base.html" %}
{% block content %}

<style>
  /* (CSS styles are unchanged) */
  .g-0 { gap: 0 !important; }
  .register-outer { min-height: 80vh; }
  .left-col { display: flex; align-items: center; justify-content: center; background: #f8f9fa; min-height: 80vh; padding: 40px; text-align: center; }
  .left-col h1 { font-size: 2.8rem; font-weight: 700; color: #198754; line-height: 1.3; }
  .left-col p { font-size: 1.2rem; color: #555; margin-top: 15px; }
  .right-col { display: flex; align-items: center; justify-content: center; background: #f8f9fa; padding: 40px; min-height: 80vh; }
  .register-card { width: 100%; max-width: 420px; padding: 30px; border-radius: 12px; background: #fff; box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1); }
  .register-card h2 { font-weight: 700; color: #198754; margin-bottom: 20px; text-align: center; }
  .register-card .form-control { border-radius: 8px; padding: 12px; }
  .register-card .btn { border-radius: 8px; padding: 12px; font-weight: 600; font-size: 1.05rem; }
  @media (min-width: 768px) {
    .left-col, .right-col { flex: 0 0 50%; max-width: 50%; }
  }
</style>

<div class="container-fluid g-0 register-outer">
  <div class="row g-0">
    <div class="col-12 col-md-6 left-col">
      <div>
        <h1>Start Fresh,<br> Build Healthy Habits</h1>
        <p>Join Helio today and take the first step toward a smarter, healthier lifestyle.</p>
      </div>
    </div>

    <div class="col-12 col-md-6 right-col">
      <div class="register-card">
        <h2>Register</h2>
        <form method="POST" id="registerForm">
          <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input type="text" class="form-control" name="username" required autocomplete="off">
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="password" name="password" required autocomplete="new-password">
          </div>
          <div class="mb-3">
            <label for="confirm_password" class="form-label">Confirm Password</label>
            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required autocomplete="new-password">
          </div>

          <!-- This div will now show all password-related errors -->
          <div id="passwordError" class="text-danger mb-3" style="font-size: 0.9em;"></div>

          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="showPassword">
            <label class="form-check-label" for="showPassword">Show Password</label>
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-success btn-lg">Register</button>
          </div>
        </form>
        <p class="text-center mt-3 mb-0">
          Already have an account?
          <a href="{{ url_for('login') }}" class="text-success fw-bold">Login</a>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- MODIFIED: JavaScript with enhanced validation -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const showPasswordCheckbox = document.getElementById('showPassword');
  const passwordField = document.getElementById('password');
  const confirmPasswordField = document.getElementById('confirm_password');
  const registerForm = document.getElementById('registerForm');
  const passwordError = document.getElementById('passwordError');

  // Logic for showing/hiding password (unchanged)
  showPasswordCheckbox.addEventListener('change', function() {
    const type = this.checked ? 'text' : 'password';
    passwordField.setAttribute('type', type);
    confirmPasswordField.setAttribute('type', type);
  });

  // --- START OF NEW VALIDATION LOGIC ---
  registerForm.addEventListener('submit', function(event) {
    const password = passwordField.value;
    const confirmPassword = confirmPasswordField.value;
    
    // Clear any previous error messages
    passwordError.textContent = '';

    // 1. Check for password match
    if (password !== confirmPassword) {
      event.preventDefault(); // Stop form submission
      passwordError.textContent = 'Passwords do not match.';
      return; // Stop further checks
    }

    // 2. Check for minimum length
    if (password.length < 5) {
      event.preventDefault();
      passwordError.textContent = 'Password must be at least 5 characters long.';
      return;
    }

    // 3. Check for at least one number
    if (!/\d/.test(password)) {
      event.preventDefault();
      passwordError.textContent = 'Password must contain at least one number.';
      return;
    }

    // 4. Check for at least one special character
    if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
      event.preventDefault();
      passwordError.textContent = 'Password must contain at least one special character.';
      return;
    }
    
    // If all checks pass, the form will submit normally.
  });
  // --- END OF NEW VALIDATION LOGIC ---
});
</script>

{% endblock %}
